# OpenFASOC_Synthesis

  * [Tools used and Installation](#tools-used-and-installation)
- [Installation](#installation)
  * [Deriving RTL-to-GDS Flow](#deriving-rtl-to-gds-flow)
    + [Input - Verilog File](#input---verilog-file)
    + [Working](#working)
    + [Output](#output)
  * [Example - Temp Sense Generator](#example---temp-sense-generator)
  * [Locating config Files](#locating-config-files)
  * [Flow Runs](#flow-runs)
  * [Verilog and Log file](#verilog-and-log-file)
  * [Example - PLL](#example---pll)
  * [Contributers](#contributers)
  * [Acknowledgement](#acknowledgement)
  * [Contact Informations](#contact-informations)
  * [Links to other part of this flows](#links-to-other-part-of-this-flows)


The FASoC Program aims to create a complete system-on-chip (SoC) synthesis tool, from user specification to GDSII. FASoC uses a unique technology to automatically synthesise "correct-by-construction" Verilog descriptions for both analog and digital circuits, allowing for a portable, single pass implementation flow. Analog circuits, such as PLLs, power management, ADCs, and sensor interfaces, are realised using the SoC synthesis tool by recasting them as structures composed primarily of digital components while maintaining analogue performance. They are then expressed as synthesizable Verilog blocks made up of digital standard cells supplemented by a few auxiliary cells generated by an automated cell generation tool. We then enable the composition of a large number of digital and analogue components into a single correct-by-construction design component by expanding the IPXACT format and the ARM Socrates tool.

## Tools used and Installation

Installation guide can be found on [readthedocs](https://openfasoc.readthedocs.io/en/latest/getting-started.html#installation) website.
Tools used are as follows:
1. **OpenRoad** used for placemement and routing 
2. **Magic** for DRC and LVS checks
3. **Yosys** for logic synthesis
4. **Klayout** for prodcuing and viewing the gds files

It is recommended to download and avail all the dependencies required for the project as mentioned above for smooth flow of project.

### Installation

- As the requirements details are of python 3.7 ( in common to most requirements) it's better to use conda environment for smooth installation.
```
conda create --name "fasoc" python=3.6  
conda activate fasoc  
```
- Git clone the OpenFASOC github repo by: 
```
git clone https://github.com/idea-fasoc/openfasoc
```

- Go to the OpenFASOC diectory and in that install all requirements mentioned above using the script provided
```
pip install -r requirements.txt  
```

## Deriving RTL-to-GDS Flow

### Input - Verilog File

![BlackBox](https://user-images.githubusercontent.com/81183082/199916951-ce4a4478-6178-40de-8841-ab5c8f29b087.jpeg)

Using python script present in the **tools** directory which reads a .json file mentioning the specifications required and after verification of the parameters, we get the verilog file which has circuit specification as mentioned in the json file.

### Working

![Workflow](https://user-images.githubusercontent.com/81183082/199916972-7711a8dd-70b6-4bb6-9590-1cb484393c98.jpeg)

Considering the working of RTL-GDS as a black box system, we get the inputs in the form of verilog file which gets feeded in the black box and then we get the output as a compiled verilog version in the pysical circuit mode. We will focus mainly on this black box system.

OpenRoad takes the input as the desgin file which is present in the design directory of the project where a **config.mk** and **verilog** files are present (inputs from previous state) along with that it also choses a platform (sky130hd in here) which are spcifiying the design specifications. We can also keep tracks of individual steps as OpenRoad creates the files in the /flow/results folder where each file will be numbered as per the step.

After this yosys runs for the synthesis and choses appropriate circuit from the available cells.

**Floorplan**

![tempsensegenDirectory](https://user-images.githubusercontent.com/81183082/199917028-d4f8a427-7ee6-4451-a918-710a8cde6d7a.jpeg)

Floorplan requires information about the power network with voltage domains and power rails which is required to know the power layout so that the circuit works properly and get a working power range for the circuit.

 ``` pdn.tcl ``` (previously pdn.cfg) provides all information on power layout required such as die area, core area and site coordinates. For example temperature sensor generator works on two power rails  such as **VDD** which powers most of the circuit and **Vin** for the ring oscillator which is present through the Header cells that we used in auxilliary cells. These voltage domains (specific to the citcuit) can be provided using the floorplan.tcl script file.

### Output
After this final step is when the layout is actually deployed using the scirpt file ```read_domain_instances.tcl ``` which reads the config.mk file and assigns the instances to the domains mentioned and also makes sure that the cells are placed in the correct voltage domains.
 
 Now the floorplan is ready and is passed to the next stage of Placement.


## Example - Temp Sense Generator
![206749704-9e007c56-7f9a-4f43-9a9a-00df8e8d6a34](https://user-images.githubusercontent.com/81183082/207868783-53d0306c-45af-46e1-88b1-d97dbb4e838e.png)
This generator creates a compact mixed-signal temperature sensor based on the topology from this paper. It consists of a ring oscillator whose frequency is controlled by the voltage drop over a MOSFET operating in subthreshold regime, where its dependency on temperature is exponential.

## Locating config Files
<img width="492" alt="config location" src="https://user-images.githubusercontent.com/81183082/207872524-a57755ee-e1ac-412b-b107-f82476db3ab1.png">


Contents of the config.mk file: 
<img width="817" alt="config-1" src="https://user-images.githubusercontent.com/81183082/207872777-99b36523-2d88-44db-87a7-cd71b4c8d134.png">
<img width="819" alt="config-2" src="https://user-images.githubusercontent.com/81183082/207872821-a124ef50-2bb5-4700-bed1-448b0867bb5d.png">


## Flow Runs
- Inside this as we know the first step is to get the verilog file as per the requirements which is handled by taking into considerations of paramters and the command to get the verilog is 
<img width="645" alt="make sky130hd_temp" src="https://user-images.githubusercontent.com/81183082/207869513-83cc6907-2dd4-4fe4-a9ae-5b7c95aa614b.png">

- After that we check for the synthesis which is a command as shown below
<img width="482" alt="make-synth" src="https://user-images.githubusercontent.com/81183082/207869525-819e394f-653e-4744-81ec-c327de62bc8e.png">

Before running the above command, we need to make sure that the working directory is flow and not the temp-sense-gen inside the generators.
- This will generate the appropriate design for the circuit using the yosys tool and generate the synthesizable verilog file and corresponding log file which is shown below.

## Verilog and Log file
- **Log file**
Log files can be found in
```
/temp-sense-gen/flow/logs/sky130hd/tempsense/
```
<img width="758" alt="yl-1" src="https://user-images.githubusercontent.com/81183082/207870342-12239d8e-49cd-4150-88e4-e57e25277c30.png">
<img width="718" alt="yl-2" src="https://user-images.githubusercontent.com/81183082/207870364-114a006c-d406-4ccb-afa4-fa1033c3040a.png">
<img width="765" alt="yl-3" src="https://user-images.githubusercontent.com/81183082/207870389-e934c7e6-54bc-415a-ac4e-0c523b3822c4.png">
<img width="759" alt="yl-4" src="https://user-images.githubusercontent.com/81183082/207870421-3559cf46-4727-4970-ae76-196f5456f4b3.png">
<img width="762" alt="yl-5" src="https://user-images.githubusercontent.com/81183082/207870511-dbfa5aac-934f-42a0-a522-70f0767a3bb5.png">
<img width="758" alt="yl-6" src="https://user-images.githubusercontent.com/81183082/207870573-65d3ef6d-dc90-471c-aece-31f80d6741e1.png">
<img width="763" alt="yl-7" src="https://user-images.githubusercontent.com/81183082/207870596-16aef533-f360-4d84-b680-a56cf414b4b4.png">

- **GDS and Verilog files**
These files can be found at
```
/temp-sense-gen/flow/results/sky130hd/tempsense/
```
<img width="428" alt="gds files" src="https://user-images.githubusercontent.com/81183082/207870956-de0492a9-cbac-4200-b038-da85167e9744.png">
**Note: I ran the whole flow and for the same reason, it shows all the files from synthesis to routing and placement and get the final gds files**

- GDS Outputs of Final Layout and merged Layout
![Screenshot 2022-12-15 at 7 00 44 PM](https://user-images.githubusercontent.com/81183082/207871700-94295538-b5f2-4d0f-b0f7-13c3ec6b7aa7.png)
FINAL GDS OUTPUT

<img width="967" alt="Screenshot 2022-12-15 at 7 02 04 PM" src="https://user-images.githubusercontent.com/81183082/207871846-95adee21-e205-4736-8053-b5aa53c785f3.png">
MERGED GDS FILE OUTPUT


## Example - PLL
- Synthesis Report
<img width="406" alt="pll-symth" src="https://user-images.githubusercontent.com/81183082/207873542-a230fdf1-e049-4d10-a4a8-f3241c254230.png">
Only the final report is shown in the above image

- GDS Output Final of PLL
<img width="789" alt="pll-final" src="https://user-images.githubusercontent.com/81183082/207874067-65903702-1d53-43a9-bf31-260f235ce4d0.png">

## Links to other part of this flows
- [Placement](https://github.com/McLucifer2646/openFASOC_placement)
- [Routing](https://github.com/Anmol-S314/OpenFASoC_Flow_Routing)
- [Mahati Basavraju's Flow](https://github.com/mahati-basavaraju/openFasoc_Flow)

## Future Works
- Rectification and identification of the cause for the crash in the routing step is needed.
- Generated Warnings and missing connection have to be sorted.

## References
- [Official Documentaion](https://chipsalliance.org/wp-content/uploads/sites/83/2021/10/OpenFASOC_-Open-Source-Fully-Autonomous-SoC-Synthesis-using-Customizable-Cell-Based-Synthesizable-Analog-Circuits-CHIPS-Alliance-Mehdi-Saligane.pdf)
- [Temp Sens Generator](https://openfasoc.readthedocs.io/en/latest/flow-tempsense.html)

## Contributers
**Paras Vekariya - iMtech Student, IIIT Bangalore**

## Acknowledgement
- **Kunal Ghosh - Director, VSD Corp. Pvt. Ltd**
- **Mahati Basavaraju - MS Research Student, IIIT Bangalore**
- **Prof. Madhav Rao - iMtech Co-ordinator, IIIT Bangalore**

## Contact Informations
- [Paras Vekariya](mailto:Paras.Vekariya@iiitb.ac.in)
- [Kunal Ghosh](mailto:kunalghosh@gmail.com)
- [Mahati Basavraju](mailto:Mahati.Basavaraju@iiitb.ac.in)

